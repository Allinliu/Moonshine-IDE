<?xml version="1.0" encoding="utf-8"?>
<resizableTitleWindow:ResizableTitleWindow xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" 
		 xmlns:mx="library://ns.adobe.com/flex/mx" title="Replace Text Matches"
		 skinClass="components.skins.ResizableTitleWindowSkin" xmlns:resizableTitleWindow="actionScripts.ui.resizableTitleWindow.*" xmlns:marker="actionScripts.ui.marker.*"
		 initialize="onInit(event)">
	<fx:Script>
		<![CDATA[
			import flash.utils.setTimeout;
			
			import mx.events.FlexEvent;
			
			import actionScripts.events.GeneralEvent;
			import actionScripts.events.WorkerEvent;
			import actionScripts.factory.FileLocation;
			import actionScripts.locator.IDEWorker;
			
			import components.skins.ResizableTitleWindowSkin;
			
			public var replaceValue:String;
			
			private var worker:IDEWorker = IDEWorker.getInstance();
			private var storedPathsForProbableReplace:Array;
			
			override protected function closeByCrossSign(event:Event):void
			{
				worker.removeEventListener(IDEWorker.WORKER_VALUE_INCOMING, onWorkerValueIncoming);
				super.closeByCrossSign(event);
			}
			
			protected function onInit(event:FlexEvent):void
			{
				worker.addEventListener(IDEWorker.WORKER_VALUE_INCOMING, onWorkerValueIncoming, false, 0, true);
				worker.sendToWorker(WorkerEvent.GET_FILE_LIST, null);
			}
			
			private function onWorkerValueIncoming(event:GeneralEvent):void
			{
				switch (event.value.event)
				{
					case WorkerEvent.GET_FILE_LIST:
						storedPathsForProbableReplace = event.value.value;
						generateUI();
						break;
				}
			}
			
			protected function generateUI():void
			{
				// ** Test **
				if (!storedPathsForProbableReplace || storedPathsForProbableReplace.length == 0) return;
				var tmpContent:String = new FileLocation(storedPathsForProbableReplace[0]).fileBridge.read() as String;
				marker1.text = tmpContent;
				marker1.highlight(replaceValue);
			}
			
		]]>
	</fx:Script>
	
	<s:VGroup height="100%" width="100%" 
			  gap="10" paddingLeft="12" paddingBottom="3" paddingTop="9" paddingRight="13">
		<s:Label text="Changes to be performed in:"/>
		<s:List id="lstFiles"
				width="100%" height="{this.height*.2}" styleName="multiLineList"/>
		<s:HGroup width="100%" height="100%">
			<marker:MarkerTextArea id="marker1"
								   width="50%" height="100%"/>
			<marker:MarkerTextArea id="marker2"
								   width="50%" height="100%"/>
		</s:HGroup>
	</s:VGroup>
	
	<resizableTitleWindow:controlBarContent>
		<s:Button id="btnCreate" label="Create"
				  styleName="darkButton"
				  enabled="false"/>
	</resizableTitleWindow:controlBarContent>
</resizableTitleWindow:ResizableTitleWindow>
